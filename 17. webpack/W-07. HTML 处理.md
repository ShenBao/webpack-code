# HTML å¤„ç†

åœ¨é¡¹ç›®ä¸­é™¤äº†éœ€è¦ JavaScriptã€CSS å’Œå›¾ç‰‡ç­‰é™æ€èµ„æºï¼Œè¿˜éœ€è¦é¡µé¢æ¥æ‰¿è½½è¿™äº›å†…å®¹å’Œé¡µé¢ç»“æ„ï¼Œæ€ä¹ˆåœ¨ Webpack ä¸­å¤„ç† HTMLã€‚å¹¶ä¸”é¡¹ç›®ä¹Ÿä¸ä»…ä»…æ˜¯å•é¡µåº”ç”¨ï¼ˆSingle-Page Applicationï¼ŒSPAï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤šé¡µåº”ç”¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨ Webpack æ¥ç»™å¤šé¡µåº”ç”¨åšæ‰“åŒ…ã€‚

## html-webpack-plugin

```bash
npm i html-webpack-plugin --save-dev
```

ç„¶åä¿®æ”¹å¯¹åº”çš„ webpack.config.js å†…å®¹ï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

module.exports = {
    mode: 'development',
    entry: {
        main: './src/index.js'
    },
    plugins: [new HtmlWebPackPlugin()]
};
```

åªéœ€è¦ç®€å•é…ç½®ï¼Œæ‰§è¡Œ webpack æ‰“åŒ…ä¹‹åï¼Œå‘ç° log ä¸­æ˜¾ç¤ºï¼Œåœ¨ dist æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ª index.html çš„æ–‡ä»¶ï¼š

æ‰“å¼€åå‘ç° HTML çš„å†…å®¹å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Webpack App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"><script defer src="main.js"></script></head>
  <body>
  </body>
</html>
```

é™¤äº† HTML å¤–ï¼Œçš„ entry ä¹Ÿè¢«ä¸»åŠ¨æ’å…¥åˆ°äº†é¡µé¢ä¸­ï¼Œè¿™æ ·æ‰“å¼€ index.html å°±ç›´æ¥åŠ è½½äº† main.js äº†ã€‚

å¦‚æœè¦ä¿®æ”¹ HTML çš„ title å’Œåç§°ï¼Œå¯ä»¥å¦‚ä¸‹é…ç½®ï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

module.exports = {
    mode: 'development',
    entry: {
        main: './src/index.js'
    },
    plugins: [new HtmlWebPackPlugin({title: 'hello', filename: 'foo.html'})]
};
```

å½¢æˆå‡ºæ¥çš„ foo.html çš„æ–‡ä»¶å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"><script defer src="main.js"></script></head>
  <body>
  </body>
</html>
```

## Template

è™½ç„¶å¯ä»¥ç®€å•çš„ä¿®æ”¹ Title è¿™é‡Œè‡ªå®šä¹‰å†…å®¹ï¼Œä½†æ˜¯å¯¹äºæ—¥å¸¸é¡¹ç›®æ¥è¯´ï¼Œè¿™è¿œè¿œä¸å¤Ÿã€‚

å¸Œæœ› HTML é¡µé¢éœ€è¦æ ¹æ®çš„æ„æ„¿æ¥ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯è¯´å†…å®¹æ˜¯æ¥å®šçš„ï¼Œç”šè‡³æ ¹æ®æ‰“åŒ…çš„ entry æœ€åç»“æœæ¥å®šï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ html-webpack-plugin çš„ template åŠŸèƒ½äº†ã€‚

æ¯”å¦‚æˆ‘åœ¨ index.js ä¸­ï¼Œç»™ id="app" çš„èŠ‚ç‚¹æ·»åŠ å†…å®¹ï¼Œè¿™æ—¶å€™ HTML çš„å†…å®¹å°±éœ€è¦è‡ªå®šä¹‰äº†ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªå«æœ‰ id="app"çš„ DIV å…ƒç´ ï¼š

å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå·±æƒ³è¦çš„ HTML æ–‡ä»¶ï¼Œæ¯”å¦‚ index.html ï¼Œåœ¨é‡Œé¢å†™ä¸Šæƒ³è¦çš„å†…å®¹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Webpack</title>
  </head>
  <body>
    <h1>hello world</h1>
    <div id="app"></div>
  </body>
</html>
```

æŠŠ webpack.config.js æ›´æ”¹å¦‚ä¸‹ï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: {
    main: './src/index.js'
  },
  plugins: [
    new HtmlWebPackPlugin({
      template: './src/index.html'
    })
  ]
};
```

## ä½¿ç”¨JSæ¨¡æ¿å¼•æ“

HTML æ¯•ç«Ÿè¿˜æ˜¯æœ‰é™ï¼Œè¿™æ—¶å€™è¿˜å¯ä»¥ä½¿ç”¨ JavaScript æ¨¡æ¿å¼•æ“æ¥åˆ›å»ºhtml-webpack-pluginçš„ Template æ–‡ä»¶ã€‚

ä»¥ [pug](https://pugjs.org/api/getting-started.html) æ¨¡æ¿å¼•æ“ä¸ºä¾‹ï¼Œæ¥è¯´æ˜ä¸‹æ€ä¹ˆä½¿ç”¨æ¨¡æ¿å¼•æ“æ–‡ä»¶çš„ Templateã€‚

é¦–å…ˆåˆ›å»ºä¸ªindex.pugæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```pug
doctype html
html(lang="en")
  head
    title="Hello Pug"
    script(type='text/javascript').
        console.log('pug inline js')
  body
    h1 Pug - node template engine
    #app
    include includes/footer.pug
```

å¦‚æœä¸ç†è§£ Pug æ¨¡æ¿çš„è¯­æ³•ï¼Œå¯ä»¥ç®€å•çœ‹ä¸‹æ–‡æ¡£ï¼Œæˆ‘è¿™é‡Œç®€å•è§£é‡Šä¸‹ï¼Œé¦–å…ˆåœ¨å¤´éƒ¨åŠ äº† title å’Œä¸€ä¸ªscriptæ ‡ç­¾ï¼Œç„¶ååœ¨ body ä¸­å†…å®¹ä¸º h1ã€id="app"çš„ div å’Œå¼•å…¥ï¼ˆincludeï¼‰äº†ä¸€ä¸ª footer.pugçš„æ–‡ä»¶ï¼š

```pug
footer#footer
  p Copyright @Copyright 2019
```

è¿™æ—¶å€™éœ€è¦ä¿®æ”¹ webpack.config.js å†…å®¹ï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: {
    main: './src/index.js'
  },
  plugins: [
    new HtmlWebPackPlugin({
      template: './src/index.pug'
    })
  ]
};
```

ä½†æ˜¯åªä¿®æ”¹template='src/index.pug'æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸º.pugè¿™æ ·çš„æ–‡ä»¶ Webpack æ˜¯ä¸ä¼šè§£æçš„ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š Pug çš„ loaderï¼š[pug-html-loader](https://www.npmjs.com/package/pug-html-loader),  é™¤äº†è¿™ä¸ªæ’ä»¶è¿˜éœ€è¦å®‰è£… [html-loader](https://www.npmjs.com/package/html-loader) ã€‚é¦–å…ˆé€šè¿‡npm i -D pug-html-loader html-loaderå®‰è£…å®ƒä»¬ï¼Œç„¶åä¿®æ”¹ webpack.config.js å†…å®¹ï¼Œæ·»åŠ  ruleï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

module.exports = {
    mode: 'development',
    entry: {
        main: './src/index.js'
    },
    plugins: [
        new HtmlWebPackPlugin({
            template: './src/index.pug'
        })
    ],
    module: {
        rules: [{test: /\.pug$/, loader: ['html-loader', 'pug-html-loader']}]
    }
};
```

æœ€åï¼Œå¾—åˆ°çš„index.htmlå†…å®¹å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello Pug</title>
    <script type="text/javascript">
      console.log('pug inline js');
    </script>
  </head>
  <body>
    <h1>Pug - node template engine</h1>
    <div id="app"></div>
    <footer id="footer"><p>Copyright @Copyright 2019</p></footer>
    <script src="main.js"></script>
  </body>
</html>
```

Pug å¼•æ“è¢«è½¬æ¢æˆ HTMLä»£ç ï¼Œé‡Œé¢åŒ…å«äº†ï¼šmain.jså’Œfooter.pugçš„å†…å®¹ã€‚

> ä½¿ç”¨ JavaScript æ¨¡æ¿å¼•æ“ï¼Œè¿˜å¯ä»¥å®šä¹‰ä¸€äº›å˜é‡ï¼Œé€šè¿‡ html-webpack-plugin ä¼ å…¥è¿›å»ã€‚


## å¤šé¡µé¡¹ç›®é…ç½®

è¦åšä¸€ä¸ªå¤šé¡µé¡¹ç›®çš„é…ç½®ï¼Œé‚£ä¹ˆéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š

- å¤šé¡µåº”ç”¨ï¼Œé¡¾åæ€ä¹‰æœ€åæ‰“åŒ…ç”Ÿæˆçš„é¡µé¢ä¹Ÿæ˜¯å¤šä¸ªï¼Œå³ HTML æ˜¯å¤šä¸ªï¼›
- å¤šé¡µåº”ç”¨ä¸ä»…ä»…æ˜¯é¡µé¢å¤šä¸ªï¼Œå…¥å£æ–‡ä»¶ä¹Ÿæ˜¯å¤šä¸ªï¼›
- å¤šé¡µåº”ç”¨å¯èƒ½é¡µé¢ä¹‹é—´é¡µé¢ç»“æ„æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ç«™é¡¹ç›®ï¼Œå…¸å‹çš„ä¸‰ä¸ªé¡µé¢æ˜¯ï¼šé¦–é¡µã€åˆ—è¡¨é¡µå’Œè¯¦æƒ…é¡µï¼Œè‚¯å®šæ¯ä¸ªé¡µé¢éƒ½ä¸ä¸€æ ·ã€‚


### å¤šé¡µé¢é—®é¢˜

å¤šé¡µé¢å°±æ˜¯æŒ‡çš„å¤šä¸ª HTML é¡µé¢ï¼Œè¿™æ—¶å€™å¯ä»¥ç›´æ¥å€ŸåŠ© html-webpack-plugin æ’ä»¶æ¥å®ç°ï¼Œåªéœ€è¦å¤šæ¬¡å®ä¾‹åŒ–ä¸€ä¸ª html-webpack-plugin çš„å®ä¾‹å³å¯ï¼Œä¾‹å¦‚ï¼š

ä¸‹é¢æ˜¯åŒä¸€ä¸ª templateï¼Œé‚£ä¹ˆå¯ä»¥åªä¿®æ”¹filenameè¾“å‡ºä¸åŒåçš„ HTML å³å¯ï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

const indexPage = new HtmlWebPackPlugin({
    template: './src/index.html',
    filename: 'index.html'
});

const listPage = new HtmlWebPackPlugin({
    template: './src/index.html',
    filename: 'list.html'
});

module.exports = {
    mode: 'development',
    entry: {
        main: './src/index.js'
    },
    plugins: [indexPage, listPage]
};

```

å¯¹äºé¡µé¢ç»“æ„ä¸åŒçš„ HTML é¡µé¢çš„é…ç½®ï¼Œä½¿ç”¨ä¸åŒçš„ template å³å¯ã€‚

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

const indexPage = new HtmlWebPackPlugin({
    template: './src/index.html',
    filename: 'index.html'
});
const listPage = new HtmlWebPackPlugin({
    template: './src/list.html',
    filename: 'list.html'
});
module.exports = {
    mode: 'development',
    entry: {
        main: './src/index.js'
    },
    plugins: [indexPage, listPage]
};
```

### å¤šå…¥å£é—®é¢˜

ä¸Šé¢çš„å¤šé¡µé¢è§£å†³æ˜¯å¤šæ¬¡å®ä¾‹åŒ– html-webpack-pluginï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°ä¸åŒï¼ˆä¸»è¦æ˜¯ filename ä¸åŒï¼‰ï¼Œæ‰“åŒ…å‡ºä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ç‰¹ç‚¹æ˜¯å¼•å…¥çš„ JavaScript æ–‡ä»¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³éƒ½æ˜¯main.jsã€‚

å¯¹äºå¤šå…¥å£ï¼Œå¹¶ä¸”å…¥å£éœ€è¦åŒºåˆ†çš„æƒ…å†µï¼Œé‚£ä¹ˆéœ€è¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

è¿™æ—¶å€™å°±éœ€è¦å€ŸåŠ© html-webpack-plugin çš„ä¸¤ä¸ªå‚æ•°äº†ï¼šchunkså’ŒexcludeChunks:

- chunksæ˜¯å½“å‰é¡µé¢åŒ…å«çš„ chunk æœ‰å“ªäº›ï¼Œå¯ä»¥ç›´æ¥ç”¨ entry çš„keyæ¥å‘½å
- excludeChunks`åˆ™æ˜¯æ’é™¤æŸäº› chunksã€‚

ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸¤ä¸ª entryï¼Œåˆ†åˆ«æ˜¯index.jså’Œlist.jsï¼Œå¸Œæœ›index.htmlè·Ÿindex.jsæ˜¯ä¸€ç»„ï¼Œlist.htmlè·Ÿlist.jsæ˜¯ä¸€ç»„ï¼Œé‚£ä¹ˆ webpack.config.js éœ€è¦ä¿®æ”¹ä¸ºï¼š

```js
const HtmlWebPackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: {
    index: './src/index.js',
    list: './src/list.js'
  },
  plugins: [
    new HtmlWebPackPlugin({template: './public/index.html', filename: 'index.html', chunks: ['index']}),
    new HtmlWebPackPlugin({template: './public/list.html', filename: 'list.html', chunks: ['list']})
  ]
};
```

## æœ€ä½³å®è·µ

æ­¥éª¤ä¸æ€è·¯ï¼š

- çº¦å®šçš„ç›®å½•ç»“æ„ï¼ˆæ–¹ä¾¿å†™é€»è¾‘ä»£ç ï¼‰ï¼›
- ä½¿ç”¨jsè¯»å–ç›®å½•ç»“æ„ä¸æ–‡ä»¶ï¼›
- åˆ›å»ºentriesæ•°ç»„ï¼›
- åˆ›å»ºHtmlWebPackPluginæ•°ç»„ï¼›
- æœ€åæ‹¼æ¥æˆwebpacké…ç½®ã€‚

é¦–å…ˆï¼Œéœ€è¦è§„å®šä¸‹ç›®å½•ç»“æ„è§„èŒƒï¼Œä¸€èˆ¬é¡¹ç›®ä¼šæœ‰ä¸‹é¢çš„ç›®å½•è§„èŒƒï¼š

```js
.
â”œâ”€â”€ dist
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ list.html
â”‚   â””â”€â”€ list.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ scripts
â”‚   â”œâ”€â”€ resolve.js
â”‚   â””â”€â”€ utils.js
â”œâ”€â”€ src
â”‚   â””â”€â”€ pages
â”œâ”€â”€ template
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ list.html
â””â”€â”€ webpack.config.js
```

ä¿è¯ template å’Œå®é™…çš„ entry æ˜¯å›ºå®šçš„ç›®å½•ï¼Œå¹¶ä¸”åå­—éƒ½æ˜¯å¯¹åº”çš„ã€‚

è¿™æ—¶å€™å¯ä»¥å†™ä¸ª Node.js ä»£ç éå†å¯¹åº”çš„è·¯å¾„ï¼Œç„¶åç”Ÿæˆ webpack.config.js çš„ entryå’Œhtml-webpack-pluginå†…å®¹ã€‚

ä½¿ç”¨äº†globby è¿™ä¸ª NPM æ¨¡å—ï¼Œå…ˆå†™äº†è¯»å–src/pages/*.jsçš„å†…å®¹ï¼Œç„¶åç”Ÿæˆentry

globbyè¿™ä¸ªåº“ï¼Œç›®å‰12.xçš„ç‰ˆæœ¬æ˜¯ES Moduleçš„ç‰ˆæœ¬ï¼Œç”¨æ³•å‘ç”Ÿäº†é‡å¤§å˜åŒ–ã€‚

```js
import {globby} from 'globby';

const paths = await globby(['*', '!cake']);

console.log(paths);
//=> ['unicorn', 'rainbow']
```

è€Œä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š

```bash
npm i globby@11
```

scripts/resolve.jsæ–‡ä»¶ï¼š

```js
const path = require('path')

// é¡¹ç›®æ ¹ç›®å½•
module.exports.resolve = (src) => path.join(path.resolve(__dirname, '../'), src)

// srcç›®å½•
module.exports.src = (src) => path.join(path.resolve(__dirname, '../src'), src)
```

scripts/utils.jsæ–‡ä»¶ï¼š

```js
const path = require('path');
const globby = require('globby');
const src = require('./resolve').src
const HtmlWebPackPlugin = require('html-webpack-plugin');

const getEntry = (source = './pages', ext='.js') => {
  // å¼‚æ­¥æ–¹å¼è·å–æ‰€æœ‰çš„è·¯å¾„
  const res = src(source)
  const paths = globby.sync(res, {
    cwd: src(source)
  });
  const rs = {};
  paths.forEach(v => {
    // è®¡ç®— filename
    const name = path.basename(v, ext);
    rs[name] = v;
  });
  return rs;
};

exports.getEntry = getEntry

// éå†`entry`å¯¹è±¡ï¼Œç„¶åç”Ÿæˆ html-webpack-plugins çš„æ•°ç»„äº†
exports.getHtmlWebpackPlugins = () => {
  const entries = getEntry('../template', '.html');
  return Object.keys(entries).reduce((plugins, filename) => {
    plugins.push(
      new HtmlWebPackPlugin({
        template: entries[filename],
        filename: `${filename}.html`,
        chunks: [filename]
      })
    );
    return plugins;
  }, []);
};
```

åœ¨ webpack.config.js ç”¨çš„æ—¶å€™ï¼Œç›´æ¥requireå¼•å…¥åˆšåˆšå†™çš„è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åï¼š

```js
const { getEntry, getHtmlWebpackPlugins } = require('./scripts/utils')

const entry = getEntry()
console.log('ğŸš€ ~ file: webpack.config.js ~ line 4 ~ entry', entry)

const htmls = getHtmlWebpackPlugins()
console.log('ğŸš€ ~ file: webpack.config.js ~ line 7 ~ htmls', htmls)

module.exports = {
  mode: 'development',
  entry: entry, 
  plugins: [
  //...
  ...getHtmlWebpackPlugins()
  ]
};
```

